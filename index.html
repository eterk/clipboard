<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <script type="text/javascript" src="js/plugin.js"></script>
    <script type="text/javascript" src="js/html2canvas.min.js"></script>
    <script>
        function originSize() {
            const div = getPicsDiv()

            const fullPageHeight = document.documentElement.scrollHeight;
            const fullPageWeight = document.documentElement.scrollWidth;
            const height = div.scrollHeight+10;
            const width = div.scrollWidth +20;
            let sizeInfo={}
            sizeInfo.height=height
            sizeInfo.width=width
            return sizeInfo
        }

        function saveItem() {

            let size=originSize()
            // 创建一个虚拟的 canvas 元素，用于绘制完整页面
            const canvas = document.createElement("canvas");
            canvas.width = size.width; // 设置 canvas 宽度为当前窗口宽度
            canvas.height = size.height; // 设置 canvas 高度为整个页面高度
        
            const div = getPicsDiv()
            if(div.childNodes.length!=0){

            html2canvas(div, canvas)
                .then(canvas => {
                    return canvas.toDataURL("image/png");
                })
                .then(base64 => {
                    eagle.window.hide();
                    clearAll();
                    console.log("clear container");
                    return eagle.item.addFromBase64(base64, getInputItemInfo())
                })
            }



        }

    </script>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div id="input-panel">
        <div id="pictures"></div>
        <input type="text" name="name" placeholder="文件名"><br>
        <input type="text" name="annotation" placeholder="添加注释"><br>
        <input type="text" name="website" placeholder="http://"><br>
        <input type="text" name="tags" placeholder="标签之间用','分割"><br>
        <button onclick="shotAndRead()">截图</button>
        <button onclick="saveItem()">保存</button>
        <button onclick="windowHide()">关闭</button>
        <button onclick="clearAll()">清理</button>
    </div>


</body>

</html>