<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <script type="text/javascript" src="js/plugin.js"></script>
    <script type="text/javascript" src="js/html2canvas.min.js"></script>
    <script>

        async function toCanvas() {
            let size = originSize()
            // 创建一个虚拟的 canvas 元素，用于绘制完整页面
            const canvas = document.createElement("canvas");
            canvas.width = size.width; // 设置 canvas 宽度为当前窗口宽度
            canvas.height = size.height; // 设置 canvas 高度为整个页面高度

            const div = getPicsDiv()
            canvasResult = await html2canvas(div, canvas)
            const base64 = canvasResult.toDataURL("image/png");
            const res = await eagle.item.addFromBase64(base64, getInputItemInfo());

            clearAll();

        }
        function saveItem() {
            let havePic = !picturesEmpty();

            if (havePic) {
                let state = container.state();
                if (!state.isReady) {
                    eagle.dialog.showMessageBox({
                        title: "Messagebox title",
                        message: state.msg,
                        detail: "Ultra message here",
                        buttons: ["OK", "Cancel"],
                        type: "info"
                    });
                } else {
                    toCanvas();
                }
            }
        }

    </script>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div id="input-panel">
        <div id="pictures"></div>
        <input type="text" name="name" placeholder="文件名"><br>
        <input type="text" name="annotation" placeholder="添加注释"><br>
        <input type="text" name="website" placeholder="http://"><br>
        <input type="text" name="tags" placeholder="标签之间用','分割"><br>
        <button onclick="shotAndRead()" name="blue" id="shot">截图</button>
        <button onclick="saveItem()" name="blue" class="need-pic">保存</button>
        <button onclick="logState()" name="blue" id="log">log</button>
        <button onclick="mergeItems()" name="blue" class="need-select">合并</button>
        <button onclick="clearAll()" name="red" class="need-pic">清理</button>
        <button onclick="windowHide()" name="red" id="close">关闭</button>
    </div>


</body>

</html>